---
title: Linear Gaussian Inverse Problems
subtitle: Derivations and discussion of linear Gaussian inverse problems.
layout: default
date: 2024-07-03
keywords: statistics
published: true
---

This post focuses on Bayesian inverse problems with the following features:
- Linear forward model.
- Additive Gaussian observation noise.
- Gaussian prior distribution.
- Prior independence of the observation noise and prior.  
We refer to such inverse problems as *linear Gaussian*. The typical Bayesian
linear regression model with a Gaussian prior on the coefficients constitutes
a common example of a linear Gaussian inverse problem. The assumptions of
linearity and Gaussianity play quite nicely together, resulting in a closed-form
Gaussian posterior distribution. Moreover, many extensions to nonlinear and/or
non-Gaussian settings rely on methods rooted in our understanding of the linear
Gaussian regime.

# Setup
We consider the following linear Gaussian regression model
\begin{align}
y &= Gu + \epsilon \tag{1} \newline
\epsilon &\sim \mathcal{N}(0, \Sigma) \newline
u &\sim \mathcal{N}(m, C), && u \perp \epsilon
\end{align}
consisting of the *observation* (or *data*) $y \in \mathbb{R}^n$, *parameter* $u \in \mathbb{R}^d$,
*noise* $\epsilon \in \mathbb{R}^n$, and linear *forward model* represented by the
matrix $G \in \mathbb{R}^{n \times d}$. The *observation covariance*
$\Sigma \in \mathbb{R}^{n \times n}$ and *prior covariance* $u \in \mathbb{R}^{d \times d}$
are both fixed positive definite matrices. The vector $m \in \mathbb{R}^d$ is the
*prior mean*. We write $u \perp \epsilon$ to indicate the key assumption that
$u$ and $\epsilon$ are a priori statistically independent. The model (1) can
equivalently be written as
\begin{align}
y|u &\sim \mathcal{N}(Gu, \Sigma) \tag{2} \newline
u &\sim \mathcal{N}(m, C),
\end{align}
which gives the explicit expression for the Gaussian likelihood $p(y|u)$.
The solution of the Bayesian inverse problem is the posterior distribution
$p(u|y)$. We provide two approaches to calculating this distribution below, which
yield different (but equivalent) expressions.

# Computing the Posterior.
## Method 1: Completing the Square
We first tackle the problem directly, using Bayes' theorem and
the matrix analog of completing the square from elementary algebra. Applying
Bayes' theorem to (2) yields
\begin{align}
p(u|y)
&\propto p(y|u)p(u) \newline
&\propto \exp\left(-\frac{1}{2}\left[(y-Gu)^\top \Sigma^{-1} (y-Gu) + (u-m)^\top C^{-1} (u-m) \right] \right) \newline
&\propto \exp\left(-\frac{1}{2}\left[u^\top(G^\top \Sigma^{-1}G + C^{-1})u -
2u^\top(G^\top \Sigma^{-1}y + C^{-1}m)\right] \right). \tag{3}
\end{align}
All we have done above is to combine the Gaussian likelihood and prior, dropping
any multiplicative constants that don't depend on $u$, and grouping like terms
in $u$. Note that since (3) is an exponential of a quadratic in $u$, then we
immediately know that the posterior must be Gaussian. It therefore remains to find
the mean $\overline{m}$ and covariance $\overline{C}$. Knowing that (3) is
proportional to a Gaussian density, let's set the term in square brackets equal to  
\begin{align}
(u - \overline{m})^\top \overline{C}^{-1} (u - \overline{m})
= u^\top \overline{C}^{-1}u - 2u^\top \overline{C}^{-1} \overline{m} +
\overline{m}^\top \overline{C}^{-1} \overline{m}
\end{align}
and equate like terms to solve for the unknowns $\overline{m}$ and $\overline{C}$.
Doing so, we find that
\begin{align}
\overline{C}^{-1} &= G^\top \Sigma^{-1} G + C^{-1} \newline
\overline{C}^{-1}\overline{m} &= G^\top \Sigma^{-1}y + C^{-1}m.
\end{align}
The $\overline{m}^\top \overline{C}^{-1} \overline{m}$ is not a problem, as it
will simply be absorbed in the proportionality sign.
Rearranging the above expressions gives the desired mean and covariance equations,
which are summarized in the following result.

<blockquote>
  <p><strong>Proposition.</strong>
  The posterior distribution under the linear Gaussian model (1) is Gaussian
  $u|y \sim \mathcal{N}(\overline{m}, \overline{C})$, with
  \begin{align}
  \overline{m} &= \overline{C} \left[G^\top \Sigma^{-1}y + C^{-1}m \right] \tag{4} \newline
  \overline{C} &= \left[G^\top \Sigma^{-1} G + C^{-1} \right]^{-1}.
  \end{align}
  </p>
</blockquote>


## Method 2: Joint Gaussian Conditioning
We now present a second method for computing $p(u|y)$. This approach relies on
the observation that the vector $(u, y)^\top \in \mathbb{R}^{d+n}$ has a
joint Gaussian distribution. This follows from the prior independence of $u$
and $\epsilon$, and is formally proved in the appendix. Writing out this joint
Gaussian explicitly gives
\begin{align}
\begin{bmatrix} u \newline y \end{bmatrix}
&\sim \mathcal{N}\left(
\begin{bmatrix} m \newline Gm \end{bmatrix},
\begin{bmatrix} C & CG^\top \newline GC & GCG^\top + \Sigma \end{bmatrix}
\right). \tag{5}
\end{align}
The mean and covariance of $u$ is immediate from (1),
and the remaining quantities are computed as:
\begin{align}
\mathbb{E}[y] &= \mathbb{E}[Gu + \epsilon]
= G\mathbb{E}[u] + \mathbb{E}[\epsilon] = Gm \tag{6} \newline
\text{Cov}[y] &= \text{Cov}[Gu + \epsilon]
= \text{Cov}[Gu] + \text{Cov}[\epsilon] = GCG^\top + \Sigma \tag{7} \newline
\text{Cov}[y, u] &= \text{Cov}[Gu + \epsilon, u]
= \text{Cov}[Gu, u] + \text{Cov}[\epsilon, u]
= GC. \tag{8}
\end{align}
In (6) we use the linearity of expectation and the fact that the noise is zero-mean.
The covariance splits into the sum in (7) due to the independence of $u$ and
$\epsilon$. This independence assumption is similarly leveraged in (8).

The conditional distributions of joint Gaussians are well-known to also be
Gaussian, and can be computed in closed-form. Applying these Gaussian conditioning
identities to (5) provides expressions for the posterior distribution $u|y$,
which is summarized in the following result.
<blockquote>
  <p><strong>Proposition.</strong>
  The posterior distribution under the linear Gaussian model (1) is Gaussian
  $u|y \sim \mathcal{N}(\overline{m}, \overline{C})$, with
  \begin{align}
  \overline{m} &= m + CG^\top [GCG^\top + \Sigma]^{-1}(y - Gm) \tag{9} \newline
  \overline{C} &= C - CG^\top [GCG^\top + \Sigma]^{-1} GC.
  \end{align}
  </p>
</blockquote>

## Equivalence of the Two Approaches
TODO

# Investigating the Posterior Equations

## The Posterior Covariance
A first important observation is that the the posterior covariance
$\overline{C}$ is independent of the data $y$. In this sense, the specific
data realization observed does not affect the uncertainty in the estimation
of $u$. The expression coming from the first derivation (4) tells us that the
posterior *precision* (inverse covariance) $\overline{C}^{-1}$ is the sum of
the prior precision $C^{-1}$ and $G^\top \Sigma^{-1}G$, which
is the observation precision $\Sigma^{-1}$ modified by the forward model. Since
the posterior covariance is the inverse of $G^\top \Sigma^{-1}G + C^{-1}$,
we should verify that this matrix is indeed invertible. First, note that
$\Sigma^{-1}$ and $C^{-1}$ are both positive definite, since the
inverse of positive definite matrices are also positive definite. Thus,
the factorization $\Sigma^{-1} = SS^\top$ exists, which implies
\begin{align}
x^\top [G^\top \Sigma^{-1}G]x
&= x^\top [G^\top SS^\top G]x
= \lVert S^\top Gx \rVert^2_2 \geq 0. \tag{10}
\end{align}
That is, $G^\top \Sigma^{-1}G$ is positive semidefinite. Since the sum of a
positive semidefinite and positive definite matrix is positive definite, then
$G^\top \Sigma^{-1}G + C^{-1}$ is positive definite, and thus invertible.

The covariance expression in (9) provides an alternative perspective. First,
the expression tells us that conditioning on the data $y$ always decreases
variance. This can be seen by noting that the matrix
$CG^\top [GCG^\top + \Sigma]^{-1} GC$ (which is subtracted from the prior
covariance) is positive semidefinite, and thus in particular has nonnegative values
on its diagonal. To show this, we use the fact that we have just proven that
$[GCG^\top + \Sigma]^{-1}$ is positive definite, and thus admits a
decomposition of the form $SS^\top$. Thus,
\begin{align}
x^\top \left(CG^\top [GCG^\top + \Sigma]^{-1} GC\right) x
= x^\top \left(CG^\top SS^\top GC\right) x
= \lVert S^\top GCx \rVert_2^2 \geq 0, \tag{11}
\end{align}
so $CG^\top [GCG^\top + \Sigma]^{-1} GC$ is indeed positive semidefinite. Note
that the covariance expression in (9) can also be written as
\begin{align}
\text{Cov}[u|y]
&= \text{Cov}[u] - \text{Cov}[u,y] \text{Cov}[y]^{-1} \text{Cov}[y, u]. \tag{12}
\end{align}

- TODO: show that $GCG^\top$ is the Hessian of the log-likelihood.
- Positive definiteness/invertibility.

# Posterior Predictive Distribution
Suppose that we are now interested in a new forward model
$\tilde{G} \in \mathbb{R}^{m \times d}$ and are interested in estimating the
unobserved quantity $\tilde{y} \in \mathbb{R}^m$ under the model
\begin{align}
\tilde{y} = \tilde{G}u + \tilde{\epsilon},
\end{align}
with the same prior distribution as in (1). For the noise distribution, we will
assume
\begin{align}
\begin{bmatrix} \tilde{\epsilon} \newline \epsilon \end{bmatrix} \sim
\mathcal{N}\left(
\begin{bmatrix} 0 \newline 0 \end{bmatrix},
\begin{bmatrix} \tilde{\Sigma} & \Sigma^\prime \newline
                [\Sigma^\prime]^\top & \Sigma \end{bmatrix}
\right),
\end{align}
again with the assumption that $\tilde{\epsilon}$ and $u$ are a priori independent.
The classic example of
this setup is prediction at a new set of inputs within a regression setup. In
this scenario, $G$ would represent the *design matrix* containing the
$n$ inputs at which the responses $y$ were observed, while $\tilde{G}$
represents a new set of $m$ inputs whose associated responses we would like
to predict. The basic regression setting with homoscedastic variance would
result in $\Sigma = \sigma^2 I_n$, $\tilde{\Sigma} = \sigma^2 I_m$, and
$\Sigma^\prime = 0$.

In the generic inverse problem formulation, we see that this is
a question of propagating the posterior uncertainty in $u$ through a new
forward model $\tilde{G}$. Concretely, we are interested in characterizing the
*predictive posterior* distribution $p(\tilde{y} | y)$.
Just as with the posterior, we present two different ways to compute this
quantity.

## Method 1: Marginalization
The first method consists of viewing $p(\tilde{y} | y)$ as the marginal
distribution of $p(\tilde{y}, u| y)$. We have,
\begin{align}
p(\tilde{y} | y)
&= \int p(\tilde{y}, u| y) du \newline
&= \int p(\tilde{y}|u,y) p(u|y) du \newline
&= \int p(\tilde{y}|u) p(u|y) du \newline
&= \int \mathcal{N}\left(\tilde{y}|\tilde{G}u, \Sigma \right) \mathcal{N}\left(u|\overline{m}, \overline{C} \right) du
\end{align}

This integral is not too difficult to compute, but there is an easier approach.
Observe that $(u, \tilde{y}, y)$ is joint Gaussian distributed (this is verified
in the appendix). Therefore, $(u, \tilde{y})|y$ is also joint Gaussian. This
implies that $\tilde{y}|y$ is also Gaussian, since Gaussians have Gaussian
marginals. It thus remains to find the mean and covariance of this distribution.
To this end, we have
\begin{align}
\mathbb{E}[\tilde{y} | y] &= \mathbb{E}[\tilde{G}u + \tilde{\epsilon} | y]
\end{align}


## Method 2: Joint Gaussian Conditioning

# Example: Linear Regression
Perhaps the most common example of a linear Gaussian model takes the form of a
Bayesian linear regression model. In this setting, we suppose that we have access
to observed input-output pairs $(x_i, y_i)_{i=1}^{n}$ and assume that the $y_i$
arise as a linear function of the $x_i$, which are then perturbed by noise.
While different formulations are possible, a popular specification assumes
\begin{align}
y_i|x_i, \beta &\sim \mathcal{N}(x_i^\top \beta, \sigma^2),
\end{align}
meaning that the magnitude of the observation noise is iid across observations.
If we stack the inputs row-wise into a matrix $X \in \mathbb{R}^{n \times d}$
and the outputs into a vector $y \in \mathbb{R}^n$, then this model can be written
as
\begin{align}
y &= X\beta + \epsilon \newline
\epsilon &\sim \mathcal{N}(0, \sigma^2 I_n) \newline
\beta &\sim \mathcal{N}(m, \sigma^2 C),
\end{align}
where we have also assumed a Gaussian prior on $\beta$. Connecting to our generic
inverse problem setup, we see that the forward model
$G = X$ is given by the data matrix, while the parameter $u = \beta$ is the
coefficient vector. The parameterization of the prior covariance as $\sigma^2 C$ is
common in this setting, as it will lead to some convenient cancellations in the
posterior formulas. Indeed, applying (4) gives the posterior
$\beta|y \sim \mathcal{N}(\overline{m}, \overline{C})$, with covariance
\begin{align}
\overline{C} &= \left[\frac{1}{\sigma^2} X^\top X + \frac{1}{\sigma^2} C^{-1} \right]^{-1}
= \sigma^2 \left[X^\top X + C^{-1} \right]^{-1}.
\end{align}
The posterior mean is thus
\begin{align}
\overline{m}
&= \overline{C} \left[\frac{1}{\sigma^2} X^\top y + \frac{1}{\sigma^2} C^{-1}m \right]
= \left[X^\top X + C^{-1} \right]^{-1} \left[X^\top y + C^{-1}m \right],
\end{align}
since the $\sigma^2$ term from the covariance cancels with its reciprocal.  

# Numerically Implementing the Posterior Equations




# Appendix

## Joint Gaussian Distribution
TODO (both for posterior and posterior predictive derivations)
